{% extends "users/base.html" %}
{% block title %}Quiz Results{% endblock title %}
{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Quiz Results</h1>

    {% if quiz_file == "Soft Skills.json" %}
    {% elif quiz_file == "Belbin.json" %}
    {% else %}
        <!-- Mostrar score y barra de progreso solo para otros cuestionarios -->
        <p class="text-center">You scored <strong>{{ score }}</strong> out of <strong>{{ total }}</strong></p>
        <p class="text-center">Time taken: <strong>{{ duration_minutes }} minutes {{ duration_seconds }} seconds</strong></p>

        <div class="progress my-4" style="height: 30px;">
            <div class="progress-bar bg-success" role="progressbar" 
                 style="width: {{ score_percentage|floatformat:2 }}%;" 
                 aria-valuenow="{{ score_percentage }}" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
                {{ score_percentage|floatformat:2 }}%
            </div>
        </div>
    {% endif %}

    {% if unanswered_questions %}
        <h3 class="mt-4">Questions You Did Not Answer</h3>
        <ul class="list-group">
            {% for question in unanswered_questions %}
            <li class="list-group-item">
                <strong>Question:</strong> {{ question.question }} <br>
            </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if wrong_questions and quiz_file != "Belbin.json" and quiz_file != "Soft Skills.json" %}
        <h3 class="mt-4">Questions You Got Wrong</h3>
        <ul class="list-group">
            {% for question in wrong_questions %}
            <li class="list-group-item">
                <strong>Question:</strong> {{ question.question }} <br>
                <strong>Your Answer:</strong> {{ question.selected_answer|default:"Not answered" }} <br>
                <strong>Correct Answer:</strong> {{ question.correct_answer }} <br>
                <strong>Improvement:</strong> {{ question.improvement|default:"No improvement available" }} <br>
            </li>
            {% endfor %}
        </ul>
    {% else %}
        <h3 class="mt-4">Statistics</h3>
        <ul class="list-group">
            {% if category_scores %}
                <h2 class="text-center">Category Scores</h2>
                <ul class="list-group">
                {% for category, score in category_scores.items %}
                    <li class="list-group-item">
                        <strong>{{ category }}:</strong> {{ score }}
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
        </ul>
        {% if chart_data %}
        <div class="text-center">
            <h2>Category Scores</h2>
            <img src="data:image/png;base64,{{ chart_data }}" alt="Category Scores Chart" class="img-fluid">
        </div>
        {% endif %}
    {% endif %}

    <div class="text-center mt-5">
        <a href="{% url 'quiz_view' %}" class="btn btn-primary">Take another quiz</a>
    </div>
</div>
    <!-- Pop-up -->
    <div id="popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #ffd54f; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); z-index: 1000; text-align: center; border-radius: 15px; border: 2px solid #64b5f6;">
        <p style="font-size: 1.5rem; margin-top: 10px; font-weight: bold; color: #0056b3;">ðŸŽ‰ Â¡Felicidades! ðŸŽ‰</p>
        <p style="font-size: 1.2rem; color: #0d47a1;">Has ganado <strong> 3 </strong> DuckyCoins</p>
        <button onclick="closePopup()" class="btn btn-primary" style="font-size: 1rem; padding: 10px 20px; ">Cerrar</button>
    </div>
    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 999;"></div>

    <script>
        // Mostrar el pop-up automÃ¡ticamente al cargar la pÃ¡gina
        window.onload = function() {
            document.getElementById('popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        };

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }
    </script>
{% endblock %}
